#
# LoPresti smart home - automation configuration for Home Assistant
#
# alza tenda se vento > 25 km/h o temperatura < 24C o se piove
# o se sono le 17.30; in ogni caso invia notifica
####################################################################

alias: 'Chiudi tenda veranda per vento/pioggia'
initial_state: True
trigger:
  - platform: numeric_state
    entity_id: sensor.netatmo_terrace_gust_strength
    above: 25
  - platform: numeric_state
    entity_id: sensor.veranda_temperature
    below: 24
  - platform: numeric_state
    entity_id: sensor.dark_sky_precip_intensity
    above: 0.2

  - platform: time
    hours: 17
    minutes: 30
    seconds: 00

condition:
  - condition: state
    entity_id: input_select.cover_veranda_state
    state: 'open'

action:
  - service: cover.open_cover
    entity_id: cover.veranda
  - service: input_select.select_option
    data:
      entity_id: input_select.cover_veranda_state
      option: 'closed'
  - service: notify.notifyglp
    data_template:
      message: "Tenda veranda chiusa, raffiche di {{ states.sensor.netatmo_terrace_gust_strength.state }} km/h"
